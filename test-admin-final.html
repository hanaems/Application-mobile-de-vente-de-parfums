<!DOCTYPE html>
<html>
<head>
    <title>Test Admin Final</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .user-item, .order-item { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px; }
        img { border: 2px solid #6a4c93; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Test Final Admin Interface</h1>
    
    <div class="section">
        <h2>ğŸ‘¥ Test Users API</h2>
        <div id="users-result">Chargement...</div>
    </div>
    
    <div class="section">
        <h2>ğŸ“¦ Test Orders API</h2>
        <div id="orders-result">Chargement...</div>
    </div>
    
    <div class="section">
        <h2>ğŸ›ï¸ Test Order Details API</h2>
        <div id="order-details-result">Chargement...</div>
    </div>
    
    <div class="section">
        <h2>ğŸŒ¹ Test Parfums avec Images</h2>
        <div id="parfums-result">Chargement...</div>
    </div>
    
    <script>
        const API_URL = 'http://192.168.11.105:3000/api';
        
        // Test Users
        fetch(`${API_URL}/admin/users`)
            .then(res => res.json())
            .then(users => {
                document.getElementById('users-result').innerHTML = `
                    <p class="success">âœ… ${users.length} utilisateurs rÃ©cupÃ©rÃ©s</p>
                    ${users.slice(0, 3).map(user => `
                        <div class="user-item">
                            <strong>#${user.id} - ${user.nom}</strong><br>
                            ğŸ“§ ${user.email}<br>
                            ğŸ“ ${user.telephone || 'N/A'}<br>
                            ğŸ›’ ${user.orders_count} commandes
                        </div>
                    `).join('')}
                `;
            })
            .catch(err => {
                document.getElementById('users-result').innerHTML = `<p class="error">âŒ Erreur: ${err.message}</p>`;
            });
        
        // Test Orders
        fetch(`${API_URL}/admin/orders`)
            .then(res => res.json())
            .then(orders => {
                document.getElementById('orders-result').innerHTML = `
                    <p class="success">âœ… ${orders.length} commandes rÃ©cupÃ©rÃ©es</p>
                    ${orders.slice(0, 3).map(order => `
                        <div class="order-item">
                            <strong>Commande #${order.id}</strong><br>
                            ğŸ‘¤ ${order.nom} (${order.user_email})<br>
                            ğŸ’° ${order.total} DH - ğŸ“Š ${order.statut}<br>
                            ğŸ“… ${new Date(order.date_commande).toLocaleDateString('fr-FR')}
                        </div>
                    `).join('')}
                `;
                
                // Test dÃ©tails de la premiÃ¨re commande
                if (orders.length > 0) {
                    const firstOrderId = orders[0].id;
                    fetch(`${API_URL}/admin/orders/${firstOrderId}/details`)
                        .then(res => res.json())
                        .then(data => {
                            document.getElementById('order-details-result').innerHTML = `
                                <p class="success">âœ… DÃ©tails commande #${firstOrderId} rÃ©cupÃ©rÃ©s</p>
                                <div class="order-item">
                                    <strong>Client:</strong> ${data.order.nom}<br>
                                    <strong>Total:</strong> ${data.order.total} DH<br>
                                    <strong>Articles:</strong> ${data.items.length} items<br>
                                    ${data.items.length > 0 ? `
                                        <div style="margin-top: 10px;">
                                            <strong>Premier article:</strong><br>
                                            ${data.items[0].parfum_nom} - ${data.items[0].parfum_marque}<br>
                                            Prix: ${data.items[0].prix_unitaire} DH x ${data.items[0].quantite}<br>
                                            ${data.items[0].parfum_image_url ? `
                                                <img src="http://192.168.11.105:3000${data.items[0].parfum_image_url}" 
                                                     style="width: 80px; height: 80px; object-fit: cover; margin-top: 5px;"
                                                     onerror="this.style.border='2px solid red'; console.error('Erreur image order item');"
                                                     onload="console.log('Image order item chargÃ©e');">
                                            ` : '<p>Pas d\'image</p>'}
                                        </div>
                                    ` : '<p>Aucun dÃ©tail d\'article (commande ancienne)</p>'}
                                </div>
                            `;
                        })
                        .catch(err => {
                            document.getElementById('order-details-result').innerHTML = `<p class="error">âŒ Erreur dÃ©tails: ${err.message}</p>`;
                        });
                }
            })
            .catch(err => {
                document.getElementById('orders-result').innerHTML = `<p class="error">âŒ Erreur: ${err.message}</p>`;
            });
        
        // Test Parfums
        fetch(`${API_URL}/parfums`)
            .then(res => res.json())
            .then(parfums => {
                const parfumsWithImages = parfums.filter(p => p.image_url);
                document.getElementById('parfums-result').innerHTML = `
                    <p class="success">âœ… ${parfums.length} parfums rÃ©cupÃ©rÃ©s (${parfumsWithImages.length} avec images)</p>
                    ${parfumsWithImages.slice(0, 3).map(parfum => `
                        <div class="user-item">
                            <strong>${parfum.nom} - ${parfum.marque}</strong><br>
                            ğŸ’° ${parfum.prix} DH<br>
                            ğŸ–¼ï¸ URL: ${parfum.image_url}<br>
                            <img src="http://192.168.11.105:3000${parfum.image_url}" 
                                 style="width: 80px; height: 80px; object-fit: cover; margin-top: 5px;"
                                 onerror="this.style.border='2px solid red'; console.error('Erreur image parfum ${parfum.id}:', this.src);"
                                 onload="console.log('Image parfum ${parfum.id} chargÃ©e:', this.src);">
                        </div>
                    `).join('')}
                `;
            })
            .catch(err => {
                document.getElementById('parfums-result').innerHTML = `<p class="error">âŒ Erreur: ${err.message}</p>`;
            });
    </script>
</body>
</html>