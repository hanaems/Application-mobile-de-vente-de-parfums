<!DOCTYPE html>
<html>
<head>
    <title>Test Fix Filtres</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px; }
        .info { background: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 4px; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîß Test Fix Filtres Admin</h1>
    
    <div class="section">
        <h2>‚úÖ Probl√®me Identifi√©</h2>
        <div class="error">
            <strong>Erreur originale:</strong><br>
            <code>Uncaught TypeError: Cannot read properties of null (reading 'value')</code><br>
            <strong>Cause:</strong> Les √©l√©ments DOM des filtres n'existaient pas au moment de l'appel √† <code>applyOrderFilters()</code>
        </div>
    </div>
    
    <div class="section">
        <h2>üõ†Ô∏è Corrections Appliqu√©es</h2>
        <div class="success">
            <strong>1. V√©rification des √©l√©ments DOM</strong><br>
            Ajout de v√©rifications <code>if (!element)</code> avant d'acc√©der aux propri√©t√©s<br><br>
            
            <strong>2. Gestion d'erreurs</strong><br>
            Messages d'erreur explicites si les √©l√©ments sont manquants<br><br>
            
            <strong>3. D√©lai d'attente</strong><br>
            Utilisation de <code>setTimeout()</code> pour attendre que le DOM soit mis √† jour<br><br>
            
            <strong>4. Debug am√©lior√©</strong><br>
            Fonction de debug qui v√©rifie l'existence des √©l√©ments DOM
        </div>
    </div>
    
    <div class="section">
        <h2>üß™ Test de l'API (pour v√©rifier que le backend fonctionne)</h2>
        <button onclick="testAPI()">Tester API Filtrage</button>
        <div id="api-test-result"></div>
    </div>
    
    <div class="section">
        <h2>üìã Instructions de Test</h2>
        <div class="info">
            <strong>Pour tester la correction :</strong><br>
            1. Allez sur l'interface admin : <a href="http://192.168.11.105:3000/admin" target="_blank">http://192.168.11.105:3000/admin</a><br>
            2. Connectez-vous avec : admin@parfums.com / admin123<br>
            3. Allez dans la section "Orders"<br>
            4. Cliquez sur "üîç Filtres" pour afficher les filtres<br>
            5. S√©lectionnez une date future (ex: 2025-12-15) dans "Date de d√©but"<br>
            6. Cliquez sur "Appliquer"<br>
            7. Vous devriez voir "Aucune commande trouv√©e" au lieu d'une erreur JavaScript<br><br>
            
            <strong>Si vous voyez encore l'erreur :</strong><br>
            - Cliquez sur le bouton "üêõ Debug" pour diagnostiquer<br>
            - Naviguez vers une autre page puis revenez aux commandes<br>
            - Actualisez la page (F5)
        </div>
    </div>
    
    <script>
        async function testAPI() {
            const container = document.getElementById('api-test-result');
            container.innerHTML = '<p>Test en cours...</p>';
            
            try {
                // Test 1: Date future (devrait retourner 0 r√©sultats)
                const response1 = await fetch('http://192.168.11.105:3000/api/admin/orders?dateFrom=2025-12-15');
                const orders1 = await response1.json();
                
                // Test 2: Toutes les commandes
                const response2 = await fetch('http://192.168.11.105:3000/api/admin/orders');
                const orders2 = await response2.json();
                
                container.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ API fonctionne correctement</strong><br>
                        Test 1 (date future): ${orders1.length} commandes (attendu: 0)<br>
                        Test 2 (toutes): ${orders2.length} commandes<br><br>
                        
                        ${orders1.length === 0 ? 
                            '‚úÖ Le filtrage par date fonctionne c√¥t√© backend' : 
                            '‚ùå Probl√®me: des commandes sont retourn√©es pour une date future'
                        }
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Erreur API:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>